{
  "name": "OctoCAT Supply - Copilot Testing Suite",
  "description": "Comprehensive test suite for the OctoCAT Supply Chain Management application - tests code generation, refactoring, bug fixes, and documentation across the Express.js API and React frontend",
  "models": ["claude-sonnet-4.5", "gpt-4.1"],
  "repoClone": {
    "repoUrl": "https://github.com/cheeragpatel/demo_copilot_agent",
    "branch": "main",
    "depth": 1,
    "keepTempDir": false
  },
  "repositoryContext": {
    "includeFiles": ["*.ts", "*.tsx", "*.js", "*.json", "*.md", "*.sql"],
    "excludeFiles": ["node_modules", "dist", ".git", "coverage"],
    "maxFiles": 50,
    "maxFileSizeBytes": 50000,
    "languages": ["typescript", "javascript", "sql"]
  },
  "options": {
    "timeoutMs": 300000,
    "retries": 2,
    "delayBetweenTestsMs": 3000
  },
  "testCases": [
    {
      "id": "api-model-001",
      "name": "Create Inventory model with TypeScript interface",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Looking at the existing models in api/src/models/ (like supplier.ts, product.ts, headquarters.ts), create a new TypeScript model file at `api/src/models/inventory.ts` that defines an Inventory interface with:\n- inventoryId: number (primary key)\n- productId: number (foreign key to Product)\n- branchId: number (foreign key to Branch)\n- quantity: number\n- minStockLevel: number\n- maxStockLevel: number\n- lastRestocked: string (ISO date)\n- status: 'in-stock' | 'low-stock' | 'out-of-stock'\n\nInclude Swagger/OpenAPI JSDoc documentation matching the style used in other models. Provide the complete code.",
      "expectedBehavior": "Should generate a TypeScript interface with proper Swagger annotations matching existing model patterns",
      "applyChanges": true,
      "targetFile": "api/src/models/inventory.ts",
      "expectedPatterns": ["interface Inventory", "@swagger", "inventoryId", "productId", "branchId", "export"],
      "tags": ["api", "model", "typescript", "swagger"]
    },
    {
      "id": "api-repo-001",
      "name": "Create Inventory repository with CRUD operations",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Based on the repository pattern used in api/src/repositories/ (examine suppliersRepo.ts or similar), create a new repository file at `api/src/repositories/inventoryRepo.ts` that:\n1. Implements CRUD operations (findAll, findById, create, update, delete)\n2. Adds custom methods: findByProduct(productId), findByBranch(branchId), findLowStock()\n3. Uses the DatabaseConnection pattern from api/src/db/connection.ts\n4. Uses the sql utility functions (toSnakeCase, objectToCamelCase) from api/src/utils/sql.ts\n5. Properly handles errors using the error types from api/src/utils/errors.ts\n\nProvide the complete TypeScript code.",
      "expectedBehavior": "Should generate a repository with proper database operations and error handling",
      "applyChanges": true,
      "targetFile": "api/src/repositories/inventoryRepo.ts",
      "expectedPatterns": ["findAll|findById|create|update|delete", "DatabaseConnection", "async", "await", "export"],
      "tags": ["api", "repository", "database", "typescript"]
    },
    {
      "id": "api-route-001",
      "name": "Create Inventory REST API routes",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Examine the existing route files in api/src/routes/ (like product.ts, supplier.ts, headquarters.ts) and create a new Express router at `api/src/routes/inventory.ts` that:\n1. Implements RESTful endpoints: GET /, GET /:id, POST /, PUT /:id, DELETE /:id\n2. Adds specialized endpoints: GET /low-stock, GET /by-product/:productId, GET /by-branch/:branchId\n3. Includes proper Swagger/OpenAPI JSDoc documentation for each endpoint\n4. Uses async/await with proper error handling\n5. Validates request parameters and body\n\nFollow the exact patterns used in existing route files. Provide the complete code.",
      "expectedBehavior": "Should generate REST routes with Swagger docs matching existing patterns",
      "applyChanges": true,
      "targetFile": "api/src/routes/inventory.ts",
      "expectedPatterns": ["router.get|router.post|router.put|router.delete", "@swagger", "async", "req.*res", "export default router"],
      "tags": ["api", "routes", "rest", "express"]
    },
    {
      "id": "api-test-001",
      "name": "Generate unit tests for SQL utilities",
      "category": "Test Generation",
      "testType": "test-generation",
      "prompt": "Looking at api/src/utils/sql.ts which contains toSnakeCase, toCamelCase, objectToSnakeCase, and objectToCamelCase functions, create comprehensive unit tests at `api/src/utils/sql.test.ts` using Vitest (as configured in api/vitest.config.ts).\n\nTest cases should include:\n1. toSnakeCase: camelCase conversion, already snake_case, single word, empty string\n2. toCamelCase: snake_case conversion, already camelCase, with numbers\n3. objectToSnakeCase: nested objects, arrays, null values\n4. objectToCamelCase: database row conversion, special keys\n5. Edge cases: undefined, empty objects, special characters\n\nProvide complete test code with describe blocks and proper test organization.",
      "expectedBehavior": "Should generate comprehensive Vitest tests for SQL utilities",
      "applyChanges": true,
      "targetFile": "api/src/utils/sql.test.ts",
      "expectedPatterns": ["describe|it|test", "expect", "toSnakeCase|toCamelCase", "import.*vitest|from 'vitest'"],
      "tags": ["testing", "unit-test", "vitest", "api"]
    },
    {
      "id": "api-test-002",
      "name": "Generate integration tests for error handler",
      "category": "Test Generation",
      "testType": "test-generation",
      "prompt": "Examine api/src/utils/errors.ts which defines DatabaseError, NotFoundError, ValidationError, and the errorHandler middleware. Create integration tests at `api/src/utils/errors.test.ts` that:\n1. Test each error type's constructor and properties\n2. Test the errorHandler middleware with mock Express req/res objects\n3. Verify correct HTTP status codes are returned for each error type\n4. Test the default 500 error handling for unknown errors\n5. Ensure error response JSON structure is correct\n\nUse Vitest and mock the Express request/response objects. Provide complete test code.",
      "expectedBehavior": "Should generate integration tests for error handling middleware",
      "applyChanges": true,
      "targetFile": "api/src/utils/errors.test.ts",
      "expectedPatterns": ["describe|it|test", "expect", "errorHandler|DatabaseError|NotFoundError", "mock|vi.fn"],
      "tags": ["testing", "integration-test", "error-handling", "api"]
    },
    {
      "id": "api-fix-001",
      "name": "Fix misleading indentation bug in headquarters route",
      "category": "Bug Fix",
      "testType": "bug-fix",
      "prompt": "In api/src/routes/headquarters.ts, there's a validateHQName function around line 324-335 that has a misleading indentation bug. The code currently is:\n\n```typescript\nfunction validateHQName(hq: any): boolean {\n  if (hq.name) \n    console.log('Name is valid');\n    return true; // This appears to be part of the if, but it's not!\n  console.log('Name is invalid');\n  return false;\n}\n```\n\nFix this bug by:\n1. Adding proper curly braces to the if statement\n2. Making the return true statement part of the if block\n3. Adding proper TypeScript typing instead of 'any'\n4. Consider adding validation for empty strings\n\nProvide the corrected function code.",
      "expectedBehavior": "Should fix the misleading indentation and add proper braces",
      "applyChanges": true,
      "targetFile": "api/src/routes/headquarters.ts",
      "expectedPatterns": ["if.*\\{", "return true", "return false", "\\}"],
      "tags": ["bug-fix", "code-quality", "typescript"]
    },
    {
      "id": "api-fix-002",
      "name": "Fix implicit type conversion in headquarters metrics",
      "category": "Bug Fix",
      "testType": "bug-fix",
      "prompt": "In api/src/routes/headquarters.ts, there's a calculateHeadquartersMetrics function around line 310-322 that has implicit type conversion issues:\n\n```typescript\nfunction calculateHeadquartersMetrics(id: any, floorCount: any, capacity: any): any {\n  const totalScore = id + floorCount + capacity; // Could be string concatenation or numeric addition\n  const averageValue = (id + floorCount) / 2; // Mixed type division\n  const displayText = `HQ-${id}${floorCount}`; // Implicit string conversion\n  ...\n}\n```\n\nFix this by:\n1. Adding proper TypeScript types (number parameters)\n2. Adding runtime validation to ensure numeric inputs\n3. Defining a proper return type interface\n4. Handling edge cases (NaN, undefined, null)\n\nProvide the corrected function with proper types.",
      "expectedBehavior": "Should fix type safety issues and add proper TypeScript types",
      "applyChanges": true,
      "targetFile": "api/src/routes/headquarters.ts",
      "expectedPatterns": ["floorCount:\\s*number", "capacity:\\s*number", "return.*\\{", "interface|type"],
      "tags": ["bug-fix", "type-safety", "typescript"]
    },
    {
      "id": "frontend-component-001",
      "name": "Create Product Card component",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Examining the frontend/src/components/ directory (Footer.tsx, Navigation.tsx, Welcome.tsx), create a reusable ProductCard component at `frontend/src/components/ProductCard.tsx` that:\n1. Displays product image, name, description, price, and discount badge\n2. Uses Tailwind CSS classes consistent with existing components\n3. Supports the useTheme() hook for dark/light mode from frontend/src/context/ThemeContext\n4. Accepts props matching the Product interface from the API (productId, name, description, price, sku, imgName, discount)\n5. Includes hover effects and responsive design\n6. Shows a 'Add to Cart' button\n\nProvide the complete React TypeScript component.",
      "expectedBehavior": "Should generate a React component with Tailwind CSS matching existing patterns",
      "applyChanges": true,
      "targetFile": "frontend/src/components/ProductCard.tsx",
      "expectedPatterns": ["export.*function|export default", "useTheme", "darkMode", "className=", "React.FC|Props"],
      "tags": ["frontend", "react", "component", "tailwind"]
    },
    {
      "id": "frontend-component-002",
      "name": "Create Inventory Status component",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Create a React component at `frontend/src/components/InventoryStatus.tsx` that displays inventory status with visual indicators:\n1. Shows stock level as a progress bar with Tailwind classes\n2. Displays status badges: green for 'in-stock', yellow for 'low-stock', red for 'out-of-stock'\n3. Uses the ThemeContext for dark/light mode support\n4. Accepts props: quantity, minStockLevel, maxStockLevel, status\n5. Shows 'Restock Needed' warning when quantity < minStockLevel\n6. Includes animations for status changes\n\nMatch the styling patterns from existing components. Provide complete TypeScript code.",
      "expectedBehavior": "Should generate an inventory status indicator component",
      "applyChanges": true,
      "targetFile": "frontend/src/components/InventoryStatus.tsx",
      "expectedPatterns": ["export.*function|export default", "useTheme", "in-stock|low-stock|out-of-stock", "className="],
      "tags": ["frontend", "react", "component", "status"]
    },
    {
      "id": "frontend-api-001",
      "name": "Create inventory API service",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Looking at frontend/src/api/config.ts which defines the API_BASE_URL and endpoints, create an inventory API service at `frontend/src/api/inventory.ts` that:\n1. Exports async functions: getInventory(), getInventoryById(id), getLowStockItems(), getInventoryByBranch(branchId)\n2. Uses the API_BASE_URL from config.ts\n3. Handles errors gracefully with try/catch\n4. Uses react-query patterns for data fetching (see how it's used in main.tsx)\n5. Includes TypeScript interfaces for the response types\n6. Returns properly typed data\n\nProvide complete TypeScript code matching existing patterns.",
      "expectedBehavior": "Should generate API service functions with proper typing",
      "applyChanges": true,
      "targetFile": "frontend/src/api/inventory.ts",
      "expectedPatterns": ["async function|const.*=.*async", "fetch|axios", "API_BASE_URL|api.baseURL", "export"],
      "tags": ["frontend", "api", "service", "typescript"]
    },
    {
      "id": "frontend-hook-001",
      "name": "Create useInventory custom hook",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Create a custom React hook at `frontend/src/hooks/useInventory.ts` that:\n1. Uses react-query's useQuery for data fetching (the app already uses react-query, see main.tsx)\n2. Provides: inventory data, loading state, error state, refetch function\n3. Includes filters: filterByStatus, filterByBranch, filterByProduct\n4. Implements optimistic updates for inventory changes\n5. Handles pagination with page and limit parameters\n6. Exports proper TypeScript types for the hook return value\n\nExamine how QueryClient is used in the app and follow those patterns.",
      "expectedBehavior": "Should generate a custom hook using react-query",
      "applyChanges": true,
      "targetFile": "frontend/src/hooks/useInventory.ts",
      "expectedPatterns": ["useQuery|useMutation", "export.*function|export const", "isLoading|isError|data", "refetch"],
      "tags": ["frontend", "react", "hook", "react-query"]
    },
    {
      "id": "db-migration-001",
      "name": "Create inventory table migration",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Looking at the existing migrations in api/sql/migrations/ and the migration runner in api/src/db/migrate.ts, create a new SQL migration file at `api/sql/migrations/004_create_inventory_table.sql` that:\n1. Creates an inventory table with columns matching the Inventory model\n2. Adds foreign key constraints to products and branches tables\n3. Creates indexes for productId, branchId, and status columns\n4. Adds a CHECK constraint for status values ('in-stock', 'low-stock', 'out-of-stock')\n5. Adds a CHECK constraint ensuring minStockLevel < maxStockLevel\n6. Includes proper SQLite syntax\n\nProvide the complete SQL migration.",
      "expectedBehavior": "Should generate valid SQLite migration with proper constraints",
      "applyChanges": true,
      "targetFile": "api/sql/migrations/004_create_inventory_table.sql",
      "expectedPatterns": ["CREATE TABLE", "FOREIGN KEY", "REFERENCES", "INDEX|CREATE INDEX", "CHECK"],
      "tags": ["database", "migration", "sql", "sqlite"]
    },
    {
      "id": "db-seed-001",
      "name": "Create inventory seed data",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Examining api/src/seedData.ts which contains seed data for products, suppliers, branches, etc., and the SQL seed files in api/sql/seed/, create a seed file at `api/sql/seed/004_inventory.sql` that:\n1. Inserts inventory records for existing products and branches\n2. Includes varied stock levels (some in-stock, some low-stock, one out-of-stock)\n3. Uses realistic quantities based on product types\n4. References actual productId and branchId values from existing seed data\n5. Includes recent lastRestocked dates\n\nProvide complete SQL INSERT statements.",
      "expectedBehavior": "Should generate realistic seed data for inventory",
      "applyChanges": true,
      "targetFile": "api/sql/seed/004_inventory.sql",
      "expectedPatterns": ["INSERT INTO", "inventory", "VALUES", "in-stock|low-stock|out-of-stock"],
      "tags": ["database", "seed", "sql", "data"]
    },
    {
      "id": "refactor-001",
      "name": "Refactor API config to use centralized constants",
      "category": "Refactoring",
      "testType": "refactoring",
      "prompt": "The API endpoints are currently defined in frontend/src/api/config.ts. Create a refactored version that:\n1. Moves all API endpoint paths to a separate constants file at `frontend/src/api/endpoints.ts`\n2. Makes endpoints type-safe with 'as const' assertion\n3. Creates helper functions for building endpoint URLs with parameters\n4. Adds a buildUrl(endpoint, params) utility that handles path parameters like :id\n5. Exports typed endpoint constants for use throughout the app\n\nProvide both the new endpoints.ts file and explain how config.ts should be updated to use it.",
      "expectedBehavior": "Should create organized endpoint constants with type safety",
      "applyChanges": true,
      "targetFile": "frontend/src/api/endpoints.ts",
      "expectedPatterns": ["as const", "export const", "ENDPOINTS|endpoints", "buildUrl|getUrl"],
      "tags": ["refactoring", "frontend", "api", "constants"]
    },
    {
      "id": "doc-api-001",
      "name": "Generate API documentation for inventory endpoints",
      "category": "Documentation",
      "testType": "documentation",
      "prompt": "Create comprehensive API documentation at `docs/api/inventory.md` for the inventory endpoints that:\n1. Documents all CRUD endpoints with request/response examples\n2. Includes curl command examples for each endpoint\n3. Shows TypeScript interfaces for request bodies and responses\n4. Documents query parameters for filtering and pagination\n5. Includes error response examples with status codes\n6. Follows the documentation style of existing docs in the docs/ folder\n\nUse proper Markdown formatting with code blocks.",
      "expectedBehavior": "Should generate comprehensive API documentation",
      "applyChanges": true,
      "targetFile": "docs/api/inventory.md",
      "expectedPatterns": ["# ", "##", "```", "curl", "GET|POST|PUT|DELETE", "200|400|404|500"],
      "tags": ["documentation", "api", "markdown"]
    },
    {
      "id": "doc-arch-001",
      "name": "Update architecture documentation with inventory module",
      "category": "Documentation",
      "testType": "documentation",
      "prompt": "Based on docs/architecture.md, create an updated section at `docs/inventory-architecture.md` that documents:\n1. The inventory module's place in the overall system architecture\n2. A Mermaid diagram showing inventory relationships with Product, Branch, and Order entities\n3. Data flow for inventory updates when orders are placed\n4. Stock level monitoring and alert logic\n5. Integration points with existing modules\n\nMatch the documentation style and Mermaid diagram format used in architecture.md.",
      "expectedBehavior": "Should generate architecture documentation with diagrams",
      "applyChanges": true,
      "targetFile": "docs/inventory-architecture.md",
      "expectedPatterns": ["# ", "mermaid", "flowchart|erDiagram|sequenceDiagram", "Inventory", "Product|Branch"],
      "tags": ["documentation", "architecture", "mermaid"]
    },
    {
      "id": "test-e2e-001",
      "name": "Create Playwright test for product listing",
      "category": "Test Generation",
      "testType": "test-generation",
      "prompt": "Looking at frontend/playwright.config.ts configuration, create an end-to-end test at `frontend/e2e/products.spec.ts` that:\n1. Tests the product listing page loads correctly\n2. Verifies product cards display name, price, and images\n3. Tests filtering products by category\n4. Tests adding a product to cart\n5. Verifies dark/light mode toggle works\n6. Uses proper Playwright best practices with page objects\n\nProvide complete Playwright test code matching the project's configuration.",
      "expectedBehavior": "Should generate E2E tests using Playwright",
      "applyChanges": true,
      "targetFile": "frontend/e2e/products.spec.ts",
      "expectedPatterns": ["test\\(|describe\\(", "expect\\(", "page.goto|page.click|page.locator", "@playwright/test"],
      "tags": ["testing", "e2e", "playwright", "frontend"]
    },
    {
      "id": "perf-001",
      "name": "Add database query optimization with indexes",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Create a SQL script at `api/sql/migrations/005_add_performance_indexes.sql` that adds performance indexes to frequently queried columns:\n1. Composite index on order_details(order_id, product_id)\n2. Index on orders(branch_id, status, order_date)\n3. Index on products(supplier_id, sku)\n4. Index on deliveries(supplier_id, status, delivery_date)\n5. Include comments explaining why each index improves performance\n\nProvide the complete SQL migration with proper SQLite syntax.",
      "expectedBehavior": "Should generate optimized database indexes",
      "applyChanges": true,
      "targetFile": "api/sql/migrations/005_add_performance_indexes.sql",
      "expectedPatterns": ["CREATE INDEX", "ON.*\\(", "--.*comment|/\\*", "order_details|orders|products|deliveries"],
      "tags": ["database", "performance", "indexes", "sql"]
    },
    {
      "id": "security-001",
      "name": "Add input validation middleware",
      "category": "Code Generation",
      "testType": "code-generation",
      "prompt": "Create input validation middleware at `api/src/middleware/validation.ts` that:\n1. Validates request body against TypeScript interfaces\n2. Sanitizes string inputs (trim, escape HTML)\n3. Validates numeric IDs are positive integers\n4. Validates email and phone formats for supplier/headquarters data\n5. Returns proper 400 Bad Request with detailed validation errors\n6. Provides reusable validation functions for common patterns\n\nBase the patterns on the existing error handling in api/src/utils/errors.ts.",
      "expectedBehavior": "Should generate validation middleware with proper error handling",
      "applyChanges": true,
      "targetFile": "api/src/middleware/validation.ts",
      "expectedPatterns": ["export", "validate|sanitize", "req.*res.*next", "400|BadRequest|ValidationError"],
      "tags": ["api", "security", "validation", "middleware"]
    }
  ]
}
